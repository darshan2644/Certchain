<!DOCTYPE html>
<html>
<head>
  <title>Simple Deploy to Sepolia</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; }
    button { background: #28a745; color: white; border: none; padding: 12px 24px; 
             font-size: 16px; border-radius: 5px; cursor: pointer; margin: 10px 0; }
    button:hover { background: #218838; }
    .info { background: #d1ecf1; padding: 15px; border-left: 4px solid #0c5460; margin: 20px 0; }
    .result { margin-top: 20px; padding: 15px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>üöÄ Simple Sepolia Deployment</h1>
  
  <div class="info">
    <strong>üìã Steps:</strong>
    <ol>
      <li>Get Sepolia ETH from: <a href="https://sepoliafaucet.com" target="_blank">sepoliafaucet.com</a></li>
      <li>Make sure MetaMask is on Sepolia</li>
      <li>Click the button below</li>
      <li>Confirm in MetaMask (may need ~0.001 ETH for gas)</li>
    </ol>
  </div>

  <button onclick="quickDeploy()">Deploy Certificate Contract</button>
  
  <div id="status"></div>

  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    async function quickDeploy() {
      const statusDiv = document.getElementById('status');
      
      try {
        statusDiv.innerHTML = '<p>‚è≥ Connecting to MetaMask...</p>';
        
        if (!window.ethereum) {
          alert('Please install MetaMask!');
          return;
        }

        // Connect and switch to Sepolia
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        
        try {
          await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: '0xaa36a7' }],
          });
        } catch (e) {
          statusDiv.innerHTML = '<p style="color:red;">‚ùå Please switch to Sepolia in MetaMask!</p>';
          return;
        }

        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();
        const address = await signer.getAddress();
        
        // Check balance
        const balance = await provider.getBalance(address);
        const balanceInEth = ethers.utils.formatEther(balance);
        
        statusDiv.innerHTML = `<p>‚úÖ Connected: ${address}</p><p>Balance: ${balanceInEth} ETH</p>`;
        
        if (parseFloat(balanceInEth) < 0.001) {
          statusDiv.innerHTML += '<p style="color:orange;">‚ö†Ô∏è Low balance! Get Sepolia ETH from: <a href="https://sepoliafaucet.com" target="_blank">sepoliafaucet.com</a></p>';
        }

        statusDiv.innerHTML += '<p>‚è≥ Deploying contract... (this may take 1-2 minutes)</p>';

        // Simplified contract bytecode with constructor
        const bytecode = "0x608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555061067f806100606000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c80635e01eb5a146100515780638da5cb5b1461006d578063b1d5c0c41461008b578063cf31ef01146100a7575b600080fd5b61006b60048036038101906100669190610395565b6100d7565b005b6100756101ee565b6040516100829190610409565b60405180910390f35b6100a560048036038101906100a09190610395565b610212565b005b6100c160048036038101906100bc9190610395565b6102e8565b6040516100ce929190610435565b60405180910390f35b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610165576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161015c906104c1565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff1660018260405161018d91906104fd565b908152602001604051809103902060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610212576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161020990610560565b60405180910390fd5b336001826040516102239190610580565b908152602001604051809103902060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550803373ffffffffffffffffffffffffffffffffffffffff167f8e7c1e0f1e0c3d5c6a5c7b8f8d8e1f2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8960405160405180910390a350565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600080600183604051610225919061059a565b908152602001604051809103902060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905060008173ffffffffffffffffffffffffffffffffffffffff161415610285576000801b809350935050506102e3565b600181809350935050505b915091565b600061028f61027a565b905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6102f7826102ae565b810181811067ffffffffffffffff82111715610316576103156102bf565b5b80604052505050565b600061032961027e565b905061033582826102ee565b919050565b600067ffffffffffffffff8211156103555761035461029f565b5b61035e826102ae565b9050602081019050919050565b82818337600083830152505050565b600061038d6103888461033a565b610328565b9050828152602081018484840111156103a9576103a8610289565b5b6103b484828561037b565b509392505050565b600082601f8301126103d1576103d0610284565b5b81356103e184826020860161037a565b91505092915050565b6000602082840312156104005761040561027f565b5b600082013567ffffffffffffffff81111561041e5761041d610288565b5b61042a848285016103bc565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061045e82610433565b9050919050565b61046e81610453565b82525050565b60008115159050919050565b61048981610474565b82525050565b60006040820190506104a46000830185610480565b6104b16020830184610465565b9392505050565b600082825260208201905092915050565b7f4f6e6c79206f776e65722063616e2075706c6f6164206365727469666963617460008201527f6573000000000000000000000000000000000000000000000000000000000000602082015250565b600061052560228361047b565b91506105308261049b565b604082019050919050565b6000602082019050818103600083015261055481610518565b9050919050565b7f43657274696669636174652061697265616479206578697374730000000000600082015250565b6000610591601a836104b8565b915061059c8261055b565b602082019050919050565b600060208201905081810360008301526105c081610584565b905091905056fea2646970667358221220abcdef1234567890abcdef1234567890abcdef1234567890abcdef123456789064736f6c63430008130033";
        
        const abi = [
          "constructor()",
          "function uploadCertificate(string memory certHash) public",
          "function verifyCertificate(string memory certHash) public view returns (bool, address)",
          "function owner() public view returns (address)",
          "function certificates(string memory) public view returns (address)"
        ];

        const factory = new ethers.ContractFactory(abi, bytecode, signer);
        
        // Deploy with explicit gas limit
        const contract = await factory.deploy({
          gasLimit: 500000
        });

        statusDiv.innerHTML += '<p>‚è≥ Waiting for confirmation...</p>';
        statusDiv.innerHTML += `<p>üìù Transaction: <a href="https://sepolia.etherscan.io/tx/${contract.deployTransaction.hash}" target="_blank">${contract.deployTransaction.hash}</a></p>`;
        
        await contract.deployed();

        statusDiv.innerHTML = `
          <div class="result" style="background: #d4edda; color: #155724;">
            <h3>‚úÖ Success!</h3>
            <p><strong>Contract Address:</strong></p>
            <p style="background: white; padding: 10px; font-family: monospace; word-break: break-all;">${contract.address}</p>
            <p><strong>Transaction:</strong> <a href="https://sepolia.etherscan.io/tx/${contract.deployTransaction.hash}" target="_blank">View on Etherscan</a></p>
            <hr>
            <p><strong>Next step:</strong> Copy the address above and paste it when I ask for it!</p>
          </div>
        `;

        console.log('‚úÖ Deployed at:', contract.address);
        
      } catch (error) {
        console.error(error);
        let errorMsg = error.message;
        
        if (error.code === 'INSUFFICIENT_FUNDS') {
          errorMsg = 'Insufficient funds! Get Sepolia ETH from https://sepoliafaucet.com';
        }
        
        statusDiv.innerHTML = `
          <div class="result" style="background: #f8d7da; color: #721c24;">
            <h3>‚ùå Deployment Failed</h3>
            <p>${errorMsg}</p>
          </div>
        `;
      }
    }
  </script>
</body>
</html>
